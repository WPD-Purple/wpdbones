/*
 * 	Ex Flex Fixed 0.3.0 - jQuery plugin
 *	written by Cyokodog	
 *
 *	Copyright (c) 2012 Cyokodog (http://d.hatena.ne.jp/cyokodog/)
 *	Dual licensed under the MIT (MIT-LICENSE.txt)
 *	and GPL (GPL-LICENSE.txt) licenses.
 *
 *	Built for jQuery library
 *	http://jquery.com
 *
 */(function(e){e.ex=e.ex||{};var t=function(t){var t=e(t),n=t[0];for(var r in n)(function(r){e.isFunction(n[r])&&(t[r]=/^get[^a-z]/.test(r)||/^is[^a-z]/.test(r)?function(){return n[r].apply(n,arguments)}:function(){var e=arguments;t.each(function(n){var i=t[n];i[r].apply(i,e)});return t})})(r);return t};e.ex.flexFixed=function(t,n,r){var i=this,s=i.config=e.extend({},e.ex.flexFixed.defaults,r);s.targets=n;s.target=s.targets.eq(t);s.index=t;s._win=e(window);s._orgMarginTop=parseInt(s.target.css("margin-top"))||0;s._orgMarginBottom=parseInt(s.target.css("margin-bottom"))||0;s._orgMarginLeft=parseInt(s.target.css("margin-left"))||0;s._orgMarginRight=parseInt(s.target.css("margin-right"))||0;s.container=e(s.container);s.fixedHeaderHeight=s.fixedHeader?e(s.fixedHeader).outerHeight():0;s.zIndex!=null&&s.target.css("z-index",s.zIndex);s.watchPosition=="auto"&&s.windowResizeAdjust=="auto"?s.watchPosition=!1:s.watchPosition==1&&s.windowResizeAdjust=="auto"&&(s.windowResizeAdjust=!1);s.target.css({position:"fixed"});i._makeCloneBox(s.target);i.adjustPosition();s._win.scroll(function(){i.adjustScrollPosition()});s.windowResizeAdjust&&s._win.resize(function(){i.adjustPosition()});s.windowResizeAdjust&&s._win.resize(function(){s._resizeTimer&&clearTimeout(s._resizeTimer);s._resizeTimer=setTimeout(function(){i.adjustPosition()},s.windowResizeDelay)});if(s.watchPosition){var o=function(){setTimeout(function(){i.adjustPosition();s.watchCallback.call(i,i);o()},s.watchDelay)};o()}};e.extend(e.ex.flexFixed.prototype,{_getMarginHeight:function(e){var t=this,n=t.config;return e.outerHeight()+ +(parseInt(e.css("margin-top"))||0)+(parseInt(e.css("margin-bottom"))||0)},_adjustCloneSize:function(e){var t=this,n=t.config;n.cloneBox.css({height:e.outerHeight(),"margin-top":parseInt(e.css("margin-top"))||0,"margin-bottom":parseInt(e.css("margin-bottom"))||0,"margin-left":parseInt(e.css("margin-left"))||0,"margin-right":parseInt(e.css("margin-right"))||0,"padding-left":(parseInt(e.css("border-left-width"))||0)+(parseInt(e.css("padding-left"))||0),"padding-right":(parseInt(e.css("border-right-width"))||0)+(parseInt(e.css("padding-right"))||0)})},_makeCloneBox:function(t){var n=this,r=n.config;r.cloneBox=e("<div/>");t.before(r.cloneBox);n._adjustCloneSize(t)},adjustPosition:function(){var e=this,t=e.config;t.containerOffset=t.container.offset();t.width!="auto"&&t.cloneBox.width()!=t.width&&t.cloneBox.width(t.width);t.target.css({width:t.cloneBox.width()});e._adjustCloneSize(t.target);t._fixedOffset=t.cloneBox.offset();e.adjustScrollPosition()},adjustScrollPosition:function(){var e=this,t=e.config,n=t.target.outerHeight()+t._orgMarginTop+t._orgMarginBottom,r=t._win.height()-n,i=t._fixedOffset.top-t._orgMarginTop-t._win.scrollTop();t._nowFixed=!1;if(i-t.fixedHeaderHeight<0){t._fromTop||(i=0);if(i-t.fixedHeaderHeight<r){t._nowFixed=!0;r>0?i=t.fixedHeaderHeight:i=r}}else t._fromTop=!0;var s=t.containerOffset.top+t.container.outerHeight()-t._win.scrollTop(),o=i+t.target.outerHeight()+t._orgMarginTop+t._orgMarginBottom,u=o-s;if(u>0){t._nowFixed=!1;t._fromTop=!1;i-=u}t.target.css({top:i,left:t._fixedOffset.left-t._win.scrollLeft()-t._orgMarginLeft})}});e.ex.flexFixed.defaults={api:!1,watchPosition:"auto",watchDelay:500,watchCallback:function(e){},container:null,fixedHeader:null,zIndex:null,width:"auto",windowResizeAdjust:"auto",windowResizeDelay:100};e.fn.exFlexFixed=function(n){var r=this,i=[];r.each(function(t){var s=r.eq(t),o=s.data("ex-flex-fixed")||new e.ex.flexFixed(t,r,n);i.push(o);s.data("ex-flex-fixed",o)});return n&&n.api?t(i):r};e.ex.flexFixed.version="0.3.0"})(jQuery);